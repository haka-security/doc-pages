


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>10. Grammar &mdash; Haka runtime 0.3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/haka.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/scripts.js"></script>
    <script type="text/javascript" src="../../_static/js/vendor/modernizr.js"></script>
    <script type="text/javascript" src="../../_static/js/foundation/foundation.js"></script>
    <script type="text/javascript" src="../../_static/js/foundation/foundation.topbar.js"></script>
    <link rel="top" title="Haka runtime 0.3.0 documentation" href="../../index.html" />
    <link rel="up" title="Welcome to Haka’s User Reference Guide!" href="refindex.html" />
    <link rel="next" title="11. State Machine" href="state_machine.html" />
    <link rel="prev" title="9. Rules" href="rule.html" /> 
  </head>
  <body>


<header id="header" role="banner">
	<div class="row">
		<div class="medium-6 columns">
			<h1 class="title"><a rel="home" title="Haka" href="http://www.haka-security.org">Haka</a></h1>
			<h2 class="description">Software Defined Security</h2>
		</div>
		<div class="medium-6 columns">
			<div id="version">Version 0.3.0</div>
		</div>
	</div>
</header>

<div class="contain-to-grid sticky">
	

<nav id="navbar" class="top-bar" data-topbar>
	<ul class="title-area">
		<!-- This is required for toggle-topbar to work -->
		<li class="name"></li>
		<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
	</ul>
	<section class="top-bar-section">
		<ul class="left">
			<li class=" ">
				<a href="../user/userindex.html">Users</a>
			</li>
			<li class=" active">
				<a href="refindex.html" class="refindex.html">References</a>
			</li>
			<li class=" ">
				<a href="../developer/devindex.html" class="">Developers</a>
			</li>
			<li class=" ">
				<a href="../faq.html" class="">Faq</a>
			</li>
			<li class="has-form">


	<form class="search" action="../../search.html" method="get" id="searchbox" style="display: none">
		<input type="hidden" name="area" value="default" />
		<input type="hidden" name="check_keywords" value="yes" />
		<div class="row collapse">
			<div class="medium-11 columns">
				<input type="text" name="q" placeholder="Search" />
			</div>
			<div class="medium-1 columns" id="clean-search-highlight">
			</div>
		</div>
	</form>
	<script type="text/javascript">$('#searchbox').show(0);</script>
</li>
		</ul>
		<ul class="right">
				<li class="right"><a href="state_machine.html" title="11. State Machine">Next &rarr;</a></li>
				<li class="right"><a href="rule.html" title="9. Rules">&larr; Prev</a></li>
				<li class="right"><a href="refindex.html" title="Welcome to Haka&#8217;s User Reference Guide!">Up &uarr;</a></li>

			<li class=" right"><a href="../../genindex.html">Index</a></li>
			<li class=" right"><a href="../../haka-modindex.html">Modules</a></li>
		</ul>
	</section>
</nav>
</div>
<div id="content">
	<div class="row">
		<ul id="breadcrumb" class="breadcrumbs medium-12 columns">
			
			<li><a href="refindex.html">Welcome to Haka&#8217;s User Reference Guide!</a></li>
			
			<li class="current"><a href="#">10. Grammar</a></li>
		</ul>
	</div>
	<div class="row">
		<div class="medium-12 columns">
			
  <div class="section" id="haka-module.haka.grammar">
<span id="grammar"></span><h1>10. Grammar<a class="headerlink" href="#haka-module.haka.grammar" title="Permalink to this headline">¶</a></h1>
<p>Haka allows the user to describe a full protocol grammar. This section describes all constructs available
to build rules for the grammar.</p>
<dl class="function">
<dt id="haka-function.haka.grammar.new">
<em class="property"> </em><tt class="descclassname">haka.grammar.</tt><tt class="descname">new</tt><big>(</big><em>name</em>, <em>descr</em><big>)</big> &rarr; grammar<a class="headerlink" href="#haka-function.haka.grammar.new" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<em>string</em>) &#8211; Name of the grammar.</li>
<li><strong>descr</strong> (<em>function</em>) &#8211; Function that describe the grammar rules.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>grammar</strong> (<a class="reference internal" href="#haka-object.Grammar" title="Grammar"><tt class="xref haka haka-class docutils literal"><span class="pre">Grammar</span></tt></a>) &#8211; Created grammar object.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create a new grammar. The name is mainly used to report detailed
information to the user.</p>
<p>The <cite>descr</cite> parameter is a function that describe the grammar rules. Its
environment allows to access all grammar primitives listed in this pages.
The functions and variables available in this scope are shown prefixed
with <cite>grammar</cite>.</p>
<p>The grammar description must export public elements in order to be able to
use them and to parse some data. To do this, the <a class="reference internal" href="#haka-function.export" title="export"><tt class="xref haka haka-func docutils literal"><span class="pre">export()</span></tt></a> function
allow to notify which elements are going to be used for parsing. You should only
export root elements that are going to be used as entry point for parsing.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.extend">
<em class="property">grammar </em><tt class="descname">extend</tt><big>(</big><em>...</em><big>)</big><a class="headerlink" href="#haka-function.extend" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>...</strong> (<a class="reference internal" href="#haka-object.Grammar" title="Grammar"><tt class="xref haka haka-class docutils literal"><span class="pre">Grammar</span></tt></a>) &#8211; List of grammar to extend.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Extend your grammar with some other grammar. It will import named rules and
exports from the grammar you extend. You can override any of the imported
named rules afterwards.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.define">
<em class="property">grammar </em><tt class="descname">define</tt><big>(</big><em>...</em><big>)</big><a class="headerlink" href="#haka-function.define" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>...</strong> (<em>string</em>) &#8211; List of elements to be defined.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Declare some grammar elements so that they can be used recursively
afterwards.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.export">
<em class="property">grammar </em><tt class="descname">export</tt><big>(</big><em>...</em><big>)</big><a class="headerlink" href="#haka-function.export" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>...</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; List of elements to be exported.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Export some grammar elements to be able to use them for parsing.</p>
</dd></dl>

<dl class="class">
<dt id="haka-object.Grammar">
<em class="property">object </em><tt class="descname">Grammar</tt><a class="headerlink" href="#haka-object.Grammar" title="Permalink to this definition">¶</a></dt>
<dd><p>Object holding grammar rules.</p>
<dl class="operator">
<dt id="haka-operator.&lt;Grammar&gt;.[]">
<em class="property"> </em><tt class="descclassname">&lt;Grammar&gt;</tt><big>[</big><em>name</em><big>]</big> &rarr; entity<a class="headerlink" href="#haka-operator.<Grammar>.[]" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<em>string</em>) &#8211; Rule name.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.CompiledGrammarEntity" title="CompiledGrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">CompiledGrammarEntity</span></tt></a>) &#8211; Compiled grammar representation.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Get a rule for parsing. This rule must have been exported using the
function <a class="reference internal" href="#haka-function.export" title="export"><tt class="xref haka haka-func docutils literal"><span class="pre">export()</span></tt></a>.</p>
</dd></dl>

</dd></dl>

<div class="section" id="elements">
<h2>10.1. Elements<a class="headerlink" href="#elements" title="Permalink to this headline">¶</a></h2>
<p>A grammar in Haka is made of various elements that are described in this section. Each one, have different
properties.</p>
<dl class="class">
<dt id="haka-object.GrammarEntity">
<em class="property">object </em><tt class="descname">GrammarEntity</tt><a class="headerlink" href="#haka-object.GrammarEntity" title="Permalink to this definition">¶</a></dt>
<dd><p>Object representing any grammar element. This object have different functions that can be used in the
grammar specification.</p>
<p>Some options are available to alter the grammar element. The list of options is specified by each grammar
element. In addition, the following option are generic and supported by all elements:</p>
<dl class="method">
<dt id="haka-function.&lt;GrammarEntity&gt;.validate">
<em class="property"> </em><tt class="descclassname">&lt;GrammarEntity&gt;:</tt><tt class="descname">validate</tt><big>(</big><em>validator</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarEntity>.validate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>validator</strong> (<em>function</em>) &#8211; Validator function.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Modified grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Add a validation function for the element. This function is called when a field is mark invalid by
setting it to <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">validator</tt><big>(</big><em>result</em><big>)</big></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;GrammarEntity&gt;.convert">
<em class="property"> </em><tt class="descclassname">&lt;GrammarEntity&gt;:</tt><tt class="descname">convert</tt><big>(</big><em>converter</em>, <em>memoize=false</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarEntity>.convert" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>converter</strong> (<a class="reference internal" href="#haka-module.haka.grammar.converter" title="haka.grammar.converter"><tt class="xref haka haka-mod docutils literal"><span class="pre">haka.grammar.converter</span></tt></a>) &#8211; Value converter.</li>
<li><strong>memoize</strong> (<em>boolean</em>) &#8211; Should the value be memoized.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Modified grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Set a conversion operation to apply to the element data.</p>
</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;GrammarEntity&gt;.memoize">
<em class="property"> </em><tt class="descclassname">&lt;GrammarEntity&gt;:</tt><tt class="descname">memoize</tt><big>(</big><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarEntity>.memoize" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Modified grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Activate memoization of the value.</p>
</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;GrammarEntity&gt;.apply">
<em class="property"> </em><tt class="descclassname">&lt;GrammarEntity&gt;:</tt><tt class="descname">apply</tt><big>(</big><em>func</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarEntity>.apply" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>func</strong> (<em>function</em>) &#8211; Apply function.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Modified grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Attach an apply function to the grammar element. It is possible to call
<em>apply</em> multiple times to execute more than one function. This function
will be called when the value is parsed:</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">func</tt><big>(</big><em>value</em>, <em>result</em>, <em>context</em><big>)</big></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>value</strong> &#8211; Current element value.</li>
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;GrammarEntity&gt;.const">
<em class="property"> </em><tt class="descclassname">&lt;GrammarEntity&gt;:</tt><tt class="descname">const</tt><big>(</big><em>value</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarEntity>.const" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>value</strong> (<em>any or function</em>) &#8211; Constant value or function to compute one.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Modified grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Mark this element as constant. Its value will be verified during
parsing. The value can be the value to compare to or a function to
compute it. In this last case, the function is the following:</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">value</tt><big>(</big><em>result</em>, <em>context</em><big>)</big> &rarr; value</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>value</strong> (<em>any</em>) &#8211; Constant value to compare to.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</dd></dl>

<div class="section" id="final-elements">
<h3>10.1.1. Final elements<a class="headerlink" href="#final-elements" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="haka-function.number">
<em class="property">grammar </em><tt class="descname">number</tt><big>(</big><em>bits</em>, <em>endian='big'</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.number" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>bits</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Size of the number in bits.</li>
<li><strong>endian</strong> (<em>string</em>) &#8211; Endianness of the raw data: <tt class="docutils literal"><span class="pre">little</span></tt> or <tt class="docutils literal"><span class="pre">big</span></tt>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Usage:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">number</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>Parse a binary number.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.token">
<em class="property">grammar </em><tt class="descname">token</tt><big>(</big><em>pattern</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.token" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pattern</strong> (<em>string</em>) &#8211; Regular expression pattern for the token.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Match a regular expression on the data and return a string.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The regular expression will surrounded by non-capturing group : <tt class="docutils literal"><span class="pre">&quot;^(?:&quot;...&quot;)&quot;</span></tt>.</p>
</div>
<p><strong>Usage:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">token</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">%s+&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="haka-function.raw_token">
<em class="property">grammar </em><tt class="descname">raw_token</tt><big>(</big><em>pattern</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.raw_token" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pattern</strong> (<em>string</em>) &#8211; Regular expression pattern for the token.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Match a regular expression on the data and return the bytes matched.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The regular expression will surrounded by non-capturing group : <tt class="docutils literal"><span class="pre">&quot;^(?:&quot;...&quot;)&quot;</span></tt>.</p>
</div>
</dd></dl>

<dl class="data">
<dt id="haka-data.flag">
<em class="property">grammar </em><tt class="descname">flag</tt><a class="headerlink" href="#haka-data.flag" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a></td>
</tr>
</tbody>
</table>
<p>Parse a flag of 1 bit and returns it as a <tt class="docutils literal"><span class="pre">boolean</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.bytes">
<em class="property">grammar </em><tt class="descname">bytes</tt><big>(</big><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.bytes" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Parse a block of data.</p>
<p><strong>Supported options:</strong></p>
<dl class="method">
<dt id="haka-function.&lt;GrammarElement&gt;.count">
<em class="property"> </em><tt class="descclassname">&lt;GrammarElement&gt;:</tt><tt class="descname">count</tt><big>(</big><em>count</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarElement>.count" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>count</strong> (<em>number or function</em>) &#8211; Number of bytes.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Current grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Specify the number of element in the bytes array.</p>
<p>The <em>count</em> parameter can be a number or a function called
to compute the number of elements:</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">count</tt><big>(</big><em>result</em>, <em>context</em><big>)</big> &rarr; count</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>count</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Number of bytes.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;GrammarElement&gt;.chunked">
<em class="property"> </em><tt class="descclassname">&lt;GrammarElement&gt;:</tt><tt class="descname">chunked</tt><big>(</big><em>callback</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarElement>.chunked" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>callback</strong> (<em>function</em>) &#8211; Callback function.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Current grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This option allows to get each data as soon as they are received in a callback function:</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">callback</tt><big>(</big><em>result</em>, <em>sub</em>, <em>islast</em>, <em>context</em><big>)</big></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>sub</strong> &#8211; Current data block.</li>
<li><strong>islast</strong> &#8211; True if this data block is the last one.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</dd></dl>

<dl class="function">
<dt id="haka-function.padding_aling">
<em class="property">grammar </em><tt class="descname">padding_aling</tt><big>(</big><em>align</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.padding_aling" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Parse some padding. The padding allows to match a bit alignment.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.field">
<em class="property">grammar </em><tt class="descname">field</tt><big>(</big><em>name</em>, <em>entity</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.field" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<em>string</em>) &#8211; Name of the field in the result.</li>
<li><strong>entity</strong> (<em>grammar entity</em>) &#8211; Entity to named.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create a named entity. This is used to give access to an entity of the grammar. It
will then be possible to access to data in the result in a security rule for instance.</p>
<p><strong>Usage:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">field</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">WS&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">%s+&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="haka-function.verify">
<em class="property">grammar </em><tt class="descname">verify</tt><big>(</big><em>verif</em>, <em>msg</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.verify" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>verif</strong> (<em>function</em>) &#8211; Verification function.</li>
<li><strong>msg</strong> (<em>string</em>) &#8211; Error message to report.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Verify some property during the parsing. If <tt class="docutils literal"><span class="pre">func</span></tt> returns <tt class="docutils literal"><span class="pre">false</span></tt>, then an error is
reported with <tt class="docutils literal"><span class="pre">msg</span></tt>.</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">verif</tt><big>(</big><em>result</em>, <em>context</em><big>)</big> &rarr; is_valid</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>is_valid</strong> (<em>boolean</em>) &#8211; False if the verification fails.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="haka-function.execute">
<em class="property">grammar </em><tt class="descname">execute</tt><big>(</big><em>exec</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.execute" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>exec</strong> (<em>function</em>) &#8211; Generic function.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Execute a generic function during the parsing. This allows to deeply customize the parsing using
regular Lua functions.</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">exec</tt><big>(</big><em>result</em>, <em>context</em><big>)</big></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="haka-function.fail">
<em class="property">grammar </em><tt class="descname">fail</tt><big>(</big><em>msg</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.fail" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>msg</strong> (<em>string</em>) &#8211; Error messgae.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Always fail the parsing when reaching this element.</p>
</dd></dl>

</div>
<div class="section" id="compounds">
<h3>10.1.2. Compounds<a class="headerlink" href="#compounds" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="haka-function.record">
<em class="property">grammar </em><tt class="descname">record</tt><big>(</big><em>entities</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.record" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>entities</strong> (<em>table of grammar entities</em>) &#8211; List of entities for the record.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create a record for a list of sub entities. Each entity is expected to appear
one by one in order.</p>
<p>When working on a stream, the data behind the elements is kept which allow
transparent access and modification.</p>
<p><strong>Supported options:</strong></p>
<dl class="method">
<dt id="haka-function.&lt;GrammarEntity&gt;.extra">
<em class="property"> </em><tt class="descclassname">&lt;GrammarEntity&gt;:</tt><tt class="descname">extra</tt><big>{</big><em>...</em><big>}</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarEntity>.extra" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Current grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Each named element in the array will be added as a extra field in the result. The table
should only contains functions.</p>
<p>The function are called with the following parameters:</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">extra</tt><big>(</big><em>result</em>, <em>context</em><big>)</big></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p><strong>Usage:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">record</span><span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">type&#39;</span><span class="p">,</span> <span class="n">number</span><span class="p">(</span><span class="mi">8</span><span class="p">)),</span>
    <span class="n">bytes</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="haka-function.sequence">
<em class="property">grammar </em><tt class="descname">sequence</tt><big>(</big><em>entities</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.sequence" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>entities</strong> (<em>table of grammar entities</em>) &#8211; List of entities for the sequence.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create a sequence for a list of sub entities. Each entity is expected to appear
one by one in order.</p>
<p>This element is similar to the <a class="reference internal" href="#haka-function.record" title="record"><tt class="xref haka haka-func docutils literal"><span class="pre">record()</span></tt></a> but the data in a stream will
immediatly be sent on the network.</p>
<p><strong>Usage:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">sequence</span><span class="p">{</span>
    <span class="n">number</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">bytes</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="haka-function.union">
<em class="property">grammar </em><tt class="descname">union</tt><big>(</big><em>entities</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.union" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>entities</strong> (<em>Table of grammar entities</em>) &#8211; List of entities for the union</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create a union for a list of sub entities. Each entity will be parsed for the
beginning of the union.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.haka.grammar.try">
<em class="property"> </em><tt class="descclassname">haka.grammar.</tt><tt class="descname">try</tt><big>(</big><em>cases</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.haka.grammar.try" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cases</strong> (<em>Table of grammar entities.</em>) &#8211; List of grammar entity to try.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Parser will try, in order, each case until one of it finishes successfully.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.branch">
<em class="property">grammar </em><tt class="descname">branch</tt><big>(</big><em>cases</em>, <em>selector</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.branch" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cases</strong> (<em>Associative table of named grammar entities</em>) &#8211; Branch cases.</li>
<li><strong>selector</strong> (<em>function</em>) &#8211; Function that will select which case to take.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create a branch. The case to take will be given by the selector function:</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">selector</tt><big>(</big><em>result</em>, <em>context</em><big>)</big> &rarr; case</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>case</strong> &#8211; The key of the case to select.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A special case named <tt class="docutils literal"><span class="pre">default</span></tt> is used as the default branch if none is found. If this
case is set to the string <tt class="docutils literal"><span class="pre">'continue'</span></tt> the parsing will continue in the case where no valid
case is found. If it is not set by the user, a parsing error will be raised.</p>
<p><strong>Usage:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">branch</span><span class="p">({</span>
        <span class="n">num8</span>  <span class="o">=</span> <span class="n">number</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
        <span class="n">num16</span> <span class="o">=</span> <span class="n">number</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
    <span class="p">},</span> <span class="k">function</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">type</span>
    <span class="k">end</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="haka-function.optional">
<em class="property">grammar </em><tt class="descname">optional</tt><big>(</big><em>entity</em>, <em>present</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.optional" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>entity</strong> (<em>grammar entity</em>) &#8211; Optional grammar entity.</li>
<li><strong>present</strong> (<em>function</em>) &#8211; Function that will select if the entity should be present.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create an optional entity. This element exists if the <cite>present</cite> function returns <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">present</tt><big>(</big><em>result</em>, <em>context</em><big>)</big> &rarr; is_present</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>is_present</strong> (<em>boolean</em>) &#8211; True if the element exists.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="haka-function.array">
<em class="property">grammar </em><tt class="descname">array</tt><big>(</big><em>entity</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.array" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>entity</strong> (<em>grammar entity</em>) &#8211; Entity representing an element of the array.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Created entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create an array of a given entity.</p>
<p><strong>Supported options:</strong></p>
<dl class="method">
<dt>
<em class="property"> </em><tt class="descclassname">&lt;GrammarElement&gt;:</tt><tt class="descname">count</tt><big>(</big><em>count</em><big>)</big> &rarr; entity</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>count</strong> (<em>number or function</em>) &#8211; Number of elements.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Current grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Specify the number of element in the array.</p>
<p>The <em>count</em> parameter can be a number or a function called
to compute the number of elements:</p>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">count</tt><big>(</big><em>result</em>, <em>context</em><big>)</big> &rarr; count</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>result</strong> &#8211; Current parsing result.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>count</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Number of bytes.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;GrammarElement&gt;.untilcond">
<em class="property"> </em><tt class="descclassname">&lt;GrammarElement&gt;:</tt><tt class="descname">untilcond</tt><big>(</big><em>check</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarElement>.untilcond" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>check</strong> (<em>function</em>) &#8211; Function to verify a property.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Current grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">check</tt><big>(</big><em>elem</em>, <em>context</em><big>)</big> &rarr; should_stop</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>elem</strong> &#8211; Current element of the array.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>should_stop</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Number <tt class="docutils literal"><span class="pre">true</span></tt> when the end of the array is reached.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>The check function is evaluated before every elements and should returns <tt class="docutils literal"><span class="pre">true</span></tt>
when the last element is reached. When called before the first element, the
parameter <em>elem</em> is <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;GrammarElement&gt;.whilecond">
<em class="property"> </em><tt class="descclassname">&lt;GrammarElement&gt;:</tt><tt class="descname">whilecond</tt><big>(</big><em>check</em><big>)</big> &rarr; entity<a class="headerlink" href="#haka-function.<GrammarElement>.whilecond" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>check</strong> (<em>function</em>) &#8211; Function to verify a property.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>entity</strong> (<a class="reference internal" href="#haka-object.GrammarEntity" title="GrammarEntity"><tt class="xref haka haka-class docutils literal"><span class="pre">GrammarEntity</span></tt></a>) &#8211; Current grammar entity.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="function">
<dt>
<em class="property"> </em><tt class="descname">whilecond</tt><big>(</big><em>elem</em>, <em>context</em><big>)</big> &rarr; should_continue</dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>elem</strong> &#8211; Current element of the array.</li>
<li><strong>context</strong> (<a class="reference internal" href="#haka-object.ParseContext" title="ParseContext"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseContext</span></tt></a>) &#8211; Full parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>should_continue</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Number <tt class="docutils literal"><span class="pre">false</span></tt> when the end of the array is reached.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>The check function is evaluated before every elements and should returns <tt class="docutils literal"><span class="pre">true</span></tt>
if more elements are expected. When called before the first element, the
parameter <em>elem</em> is <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
</dd></dl>

<p><strong>Usage:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">array</span><span class="p">(</span><span class="n">number</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
    <span class="p">:</span><span class="n">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="haka-module.haka.grammar.converter">
<span id="converters"></span><h2>10.2. Converters<a class="headerlink" href="#haka-module.haka.grammar.converter" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="haka-object.Converter">
<em class="property">object </em><tt class="descname">Converter</tt><a class="headerlink" href="#haka-object.Converter" title="Permalink to this definition">¶</a></dt>
<dd><p>A converter allows to apply some processing to a parsing result value.</p>
<dl class="method">
<dt id="haka-function.&lt;Converter&gt;.get">
<em class="property"> </em><tt class="descclassname">&lt;Converter&gt;.</tt><tt class="descname">get</tt><big>(</big><em>val</em><big>)</big><a class="headerlink" href="#haka-function.<Converter>.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the converted value from the raw data. This happens when the user tries
to get the value of a field for instance.</p>
</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;Converter&gt;.set">
<em class="property"> </em><tt class="descclassname">&lt;Converter&gt;.</tt><tt class="descname">set</tt><big>(</big><em>val</em><big>)</big><a class="headerlink" href="#haka-function.<Converter>.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the converted value to store in the raw data. This happens when the user
modify the value of on of the field.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If setter is nil then field will be read-only.</p>
</div>
</dd></dl>

<p><strong>Usage:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="kd">local</span> <span class="n">my_converter</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">get</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span><span class="p">:</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">.&quot;</span><span class="p">)</span>
    <span class="k">end</span><span class="p">,</span>
    <span class="n">set</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<div class="section" id="predefined-converters">
<h3>10.2.1. Predefined converters<a class="headerlink" href="#predefined-converters" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="haka-function.haka.grammar.converter.mult">
<em class="property"> </em><tt class="descclassname">haka.grammar.converter.</tt><tt class="descname">mult</tt><big>(</big><em>val</em><big>)</big> &rarr; converter<a class="headerlink" href="#haka-function.haka.grammar.converter.mult" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>val</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Multiple to apply to the raw value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>converter</strong> (<a class="reference internal" href="#haka-object.Converter" title="Converter"><tt class="xref haka haka-class docutils literal"><span class="pre">Converter</span></tt></a>) &#8211; Converter</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Create a converter that will apply a multiplication to the raw
data.</p>
</dd></dl>

<dl class="data">
<dt id="haka-data.haka.grammar.converter.bool">
<em class="property"> </em><tt class="descclassname">haka.grammar.converter.</tt><tt class="descname">bool</tt><a class="headerlink" href="#haka-data.haka.grammar.converter.bool" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="#haka-object.Converter" title="Converter"><tt class="xref haka haka-class docutils literal"><span class="pre">Converter</span></tt></a>&nbsp;</td>
</tr>
</tbody>
</table>
<p>Convert the raw value into a boolean.</p>
</dd></dl>

<dl class="function">
<dt id="haka-function.haka.grammar.converter.tonumber">
<em class="property"> </em><tt class="descclassname">haka.grammar.converter.</tt><tt class="descname">tonumber</tt><big>(</big><em>format</em>, <em>base</em><big>)</big> &rarr; converter<a class="headerlink" href="#haka-function.haka.grammar.converter.tonumber" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>format</strong> (<em>string</em>) &#8211; String format to use when converting from number to string.</li>
<li><strong>base</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Base to use for the convertion.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>converter</strong> (<a class="reference internal" href="#haka-object.Converter" title="Converter"><tt class="xref haka haka-class docutils literal"><span class="pre">Converter</span></tt></a>) &#8211; Converter</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Convert a raw string value into a number.</p>
</dd></dl>

</div>
</div>
<div class="section" id="compiled-grammar">
<h2>10.3. Compiled grammar<a class="headerlink" href="#compiled-grammar" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="haka-object.CompiledGrammarEntity">
<em class="property">object </em><tt class="descname">CompiledGrammarEntity</tt><a class="headerlink" href="#haka-object.CompiledGrammarEntity" title="Permalink to this definition">¶</a></dt>
<dd><p>Compiled grammar representation.</p>
<dl class="method">
<dt id="haka-function.&lt;CompiledGrammarEntity&gt;.parse">
<em class="property"> </em><tt class="descclassname">&lt;CompiledGrammarEntity&gt;:</tt><tt class="descname">parse</tt><big>(</big><em>iter</em>, <em>result=nil</em>, <em>user=nil</em><big>)</big> &rarr; result, error<a class="headerlink" href="#haka-function.<CompiledGrammarEntity>.parse" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>iter</strong> (<a class="reference internal" href="vbuffer.html#haka-object.vbuffer_iterator" title="vbuffer_iterator"><tt class="xref haka haka-class docutils literal"><span class="pre">vbuffer_iterator</span></tt></a>) &#8211; Data iterator.</li>
<li><strong>result</strong> (<em>abstract table</em>) &#8211; Object where the parsing result will be stored. If <cite>nil</cite>, a generic result object will be created.</li>
<li><strong>user</strong> (<em>table</em>) &#8211; User object that will be stored in the parsing context.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>result</strong> (<em>table for the result</em>) &#8211; The result of the parsing.</li>
<li><strong>error</strong> (<a class="reference internal" href="#haka-object.ParseError" title="ParseError"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseError</span></tt></a>) &#8211; An error if needed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Parse the data and store all results in the object returned by the function. In case of error, the error
desciption is also returned.</p>
</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;CompiledGrammarEntity&gt;.create">
<em class="property"> </em><tt class="descclassname">&lt;CompiledGrammarEntity&gt;:</tt><tt class="descname">create</tt><big>(</big><em>iter</em>, <em>result=nil</em>, <em>init={}</em><big>)</big> &rarr; result, error<a class="headerlink" href="#haka-function.<CompiledGrammarEntity>.create" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>iter</strong> (<a class="reference internal" href="vbuffer.html#haka-object.vbuffer_iterator" title="vbuffer_iterator"><tt class="xref haka haka-class docutils literal"><span class="pre">vbuffer_iterator</span></tt></a>) &#8211; Data iterator.</li>
<li><strong>result</strong> (<em>abstract table</em>) &#8211; Object where the parsing result will be stored. If <cite>nil</cite>, a generic result object will be created.</li>
<li><strong>init</strong> (<em>table</em>) &#8211; Optional initialization table.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>result</strong> (<em>table for the result</em>) &#8211; The result of the parsing.</li>
<li><strong>error</strong> (<a class="reference internal" href="#haka-object.ParseError" title="ParseError"><tt class="xref haka haka-class docutils literal"><span class="pre">ParseError</span></tt></a>) &#8211; An error if needed.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Initialize the data from an initialization table and returned the parsing result. In case of error, the error
desciption is also returned.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="parsing-error">
<h2>10.4. Parsing error<a class="headerlink" href="#parsing-error" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="haka-object.ParseError">
<em class="property">object </em><tt class="descname">ParseError</tt><a class="headerlink" href="#haka-object.ParseError" title="Permalink to this definition">¶</a></dt>
<dd><p>Parsing error description.</p>
<dl class="attribute">
<dt id="haka-attribute.&lt;ParseError&gt;.iterator">
<em class="property"> </em><tt class="descclassname">&lt;ParseError&gt;.</tt><tt class="descname">iterator</tt><a class="headerlink" href="#haka-attribute.<ParseError>.iterator" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="vbuffer.html#haka-object.vbuffer_iterator" title="vbuffer_iterator"><tt class="xref haka haka-class docutils literal"><span class="pre">vbuffer_iterator</span></tt></a>&nbsp;</td>
</tr>
</tbody>
</table>
<p>Iterator at the position where the parsing error occurred.</p>
</dd></dl>

<dl class="attribute">
<dt id="haka-attribute.&lt;ParseError&gt;.rule">
<em class="property"> </em><tt class="descclassname">&lt;ParseError&gt;.</tt><tt class="descname">rule</tt><a class="headerlink" href="#haka-attribute.<ParseError>.rule" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>Name of the rule where the error occurred.</p>
</dd></dl>

<dl class="attribute">
<dt id="haka-attribute.&lt;ParseError&gt;.description">
<em class="property"> </em><tt class="descclassname">&lt;ParseError&gt;.</tt><tt class="descname">description</tt><a class="headerlink" href="#haka-attribute.<ParseError>.description" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>Full description of the parsing error.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="parsing-context">
<h2>10.5. Parsing context<a class="headerlink" href="#parsing-context" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="haka-object.ParseContext">
<em class="property">object </em><tt class="descname">ParseContext</tt><a class="headerlink" href="#haka-object.ParseContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Parsing context used in all parsing related functions.</p>
<dl class="method">
<dt id="haka-function.&lt;ParseContext&gt;.result">
<em class="property"> </em><tt class="descclassname">&lt;ParseContext&gt;:</tt><tt class="descname">result</tt><big>(</big><em>index</em><big>)</big><a class="headerlink" href="#haka-function.<ParseContext>.result" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>index</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Index of the result in the stack.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Get a parsing result from the stack of results. This stack holds all results
created during the parsing for records, arrays...</p>
<p>The index can be a normal index (ie. <tt class="docutils literal"><span class="pre">1</span></tt>
being the top-level result...) or a pseudo index when it is negative. In this
case the return value is the result at the position stating from the last
element. For instance <tt class="docutils literal"><span class="pre">-1</span></tt> is the last result, <tt class="docutils literal"><span class="pre">-2</span></tt> is the last but one
result.</p>
</dd></dl>

<dl class="attribute">
<dt id="haka-attribute.&lt;ParseContext&gt;.user">
<em class="property"> </em><tt class="descclassname">&lt;ParseContext&gt;.</tt><tt class="descname">user</tt><a class="headerlink" href="#haka-attribute.<ParseContext>.user" title="Permalink to this definition">¶</a></dt>
<dd><p>User object.</p>
</dd></dl>

<dl class="method">
<dt id="haka-function.&lt;ParseContext&gt;.lookahead">
<em class="property"> </em><tt class="descclassname">&lt;ParseContext&gt;:</tt><tt class="descname">lookahead</tt><big>(</big><big>)</big> &rarr; byte<a class="headerlink" href="#haka-function.<ParseContext>.lookahead" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><ul class="first last simple">
<li><strong>byte</strong> (<a class="reference internal" href="#haka-function.number" title="number"><em>number</em></a>) &#8211; Next byte.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Return the next byte. This function can be used to resolve grammar ambiguity.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="example">
<h2>10.6. Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>This is an example of a very simple grammar expressed in Haka:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="kd">local</span> <span class="n">grammar</span> <span class="o">=</span> <span class="n">haka</span><span class="p">.</span><span class="n">grammar</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">example&quot;</span><span class="p">,</span> <span class="n">fonction</span> <span class="p">()</span>
    <span class="n">elem</span> <span class="o">=</span> <span class="n">record</span><span class="p">{</span>
        <span class="n">field</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">A&quot;</span><span class="p">,</span> <span class="n">number</span><span class="p">(</span><span class="mi">32</span><span class="p">)),</span>
        <span class="n">field</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">B&quot;</span><span class="p">,</span> <span class="n">number</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="n">block</span> <span class="o">=</span> <span class="n">record</span><span class="p">{</span>
        <span class="n">field</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">count&quot;</span><span class="p">,</span> <span class="n">number</span><span class="p">(</span><span class="mi">32</span><span class="p">)),</span>
        <span class="n">field</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">list&quot;</span><span class="p">,</span> <span class="n">array</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="p">:</span><span class="n">count</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">count</span>
            <span class="k">end</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="n">export</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="k">end</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


		</div>
	</div>
</div>



<footer id="footer">
	<div class="row" role="complementary">
		<div class="medium-12 columns">
			&copy; Copyright 2014, Arkoon Network Security, OpenWide and Telecom ParisTech.
		</div>
	</div>
</footer>
<script>
	  $(document).foundation();
</script>



<script type="text/javascript" src="http://www.haka-security.org/js/track.js"></script>


  </body>
</html>